name: ci
run-name: CarpetX tests
on: [push]
jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install packages
        run: |
          export DEBIAN_FRONTEND=noninteractive
          sudo apt-get update
          sudo apt-get --no-install-recommends --yes install \
              build-essential \
              ca-certificates \
              g++ \
              gfortran \
              git \
              hdf5-tools \
              libboost-all-dev \
              libfftw3-dev \
              libgit2-dev \
              libgsl-dev \
              libhdf5-dev \
              libhwloc-dev \
              libopenblas-dev \
              libopenmpi-dev \
              libpetsc-real-dev \
              libudev-dev \
              perl \
              pkg-config \
              python2 \
              python3 \
              python3-pip \
              python3-requests \
              rsync \
              subversion \
              wget \
              zlib1g-dev
      - name: Restore dependencies
        uses: actions/cache@v3
        with:
          # Note: Change this key if the dependencies change, e.g. if we install newer versions
          # Update the respective file name in `install_dependencies.sh` as well
          key: dependencies-1
          path: |
            /usr/local
      - name: Install dependencies
        run: |
          .github/ci/install_dependencies.sh
      # - name: Download Cactus
      #   run: |
      #     # /home/runner/work/CarpetX/CarpetX
      #     cd ..
      #     wget https://raw.githubusercontent.com/gridaphobe/CRL/ET_2022_11/GetComponents
      #     chmod a+x GetComponents
      #     ./GetComponents --parallel https://bitbucket.org/einsteintoolkit/manifest/raw/ET_2022_11/einsteintoolkit.th
      #     mv CarpetX Cactus/repos
      #     cp CarpetX/.github/workflows/actions.ini Cactus/simfactory/mdb/machines
      #     cp CarpetX/.github/workflows/actions.cfg Cactus/simfactory/mdb/options
      # - name: Build Cactus
      #   run: |
      #     cd Cactus
      #     ./simfactory/bin/sim --machine=actions build sim
      # - name: Run Cactus tests
